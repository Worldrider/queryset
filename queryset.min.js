/**
 * --------------------------------------------------------------------------
 * QuerySet (v1.0.1): queryset.js
 * Licensed under MIT (https://github.com/Worldrider/queryset/blob/master/LICENSE.txt)
 * --------------------------------------------------------------------------
 */
"use strict";class QuerySet extends Array{constructor(){let r=[];if(1==arguments.length&&Array.isArray(arguments[0]))for(var t=0;t<arguments[0].length;t++)r.push(arguments[0][t]);else r=Array.from(arguments);super(...r),this.setConfig()}setConfig(r){this.separator=r&&r.separator?r.separator:"__",window.moment&&(this.date_formats=r&&r.date_formats?r.date_formats:["DD/MM/YYYY","DD-MM-YYYY","DD.MM.YYYY","DD/MM/YYYY HH:mm","DD-MM-YYYY HH:mm","DD.MM.YYYY HH:mm","YYYY-MM-DDThh:mm:ss","YYYY/MM/DD","YYYY-MM-DD","YYYY.MM.DD","YYYY/MM/DD HH:mm","YYYY-MM-DD HH:mm","YYYY.MM.DD HH:mm"])}getConfig(){return{separator:this.separator,date_formats:this.date_formats}}get(r){if(!r)return null;if(!Number.isInteger(r)&&r.constructor!==String)return this.filter(r).first();for(var t=0;t<this.length;t++)if(QuerySet.get_pk(this[t])==parseInt(r))return this[t];return null}update(r){if(QuerySet.get_pk(r))for(var t=0;t<this.length;t++)for(var e in r)r.hasOwnProperty(e)&&(this[t][e]=r[e]);return this}getFilter(r,t,e,i,n){function s(r){if(null==r)return!0;if(Array.isArray(r)&&0==r.length)return!0;if(r.constructor===Object){for(var t in r)if(r.hasOwnProperty(t))return!1;return JSON.stringify(r)===JSON.stringify({})}return!1}function u(r,t,e){for(var i=0;i<t.length;i++){var l=t[i];if(!r.hasOwnProperty(l)&&("id"!=l&&"pk"!=l||!QuerySet.get_pk(r))){if("isnull"==t[t.length-1]){if(1==e)return!0;if(0==e)return!1}if(i==t.length-1){if("not"==l){if(null==e)return!s(r);if(r!=e)return!0}else if("isnull"==l){if(1==e)return s(r);if(0==e)return!s(r)}else if("startswith"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().startsWith(e.trim()))return!0}else if("istartswith"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().toLowerCase().startsWith(e.trim().toLowerCase()))return!0}else if("endswith"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().endsWith(e.trim()))return!0}else if("iendswith"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().toLowerCase().endsWith(e.trim().toLowerCase()))return!0}else if("contains"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&-1!==r.trim().indexOf(e.trim()))return!0}else if("icontains"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&-1!==r.trim().toLowerCase().indexOf(e.trim().toLowerCase()))return!0}else if("exact"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim()==e.trim())return!0}else if("iexact"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().toLowerCase()==e.trim().toLowerCase())return!0}else if("in"==l){if(null!=e&&Array.isArray(e))for(var a=0;a<e.length;a++)if(r==e[a])return!0}else if("range"==l){if(null!=e&&Array.isArray(e)){var f=e[0],o=e[e.length-1],h=QuerySet.parseDate(r,n),g=QuerySet.parseDate(f,n),p=QuerySet.parseDate(o,n);if(g&&p){if(h>=g&&h<=p)return!0}else if(r>=f&&r<=o)return!0}}else if("lt"==l){if(null!=e){g=QuerySet.parseDate(r,n),p=QuerySet.parseDate(e,n);if(g&&p){if(g<p)return!0}else if(r<e)return!0}}else if("lte"==l){if(null!=e){g=QuerySet.parseDate(r,n),p=QuerySet.parseDate(e,n);if(g&&p){if(g<=p)return!0}else if(r<=e)return!0}}else if("gt"==l){if(null!=e){g=QuerySet.parseDate(r,n),p=QuerySet.parseDate(e,n);if(g&&p){if(g>p)return!0}else if(r>e)return!0}}else if("gte"==l){if(null!=e){g=QuerySet.parseDate(r,n),p=QuerySet.parseDate(e,n);if(g&&p){if(g>=p)return!0}else if(r>=e)return!0}}else if(null==e)return!0}else if("not"!=t[t.length-1]&&null==e)return!0;return!1}if(r="id"==l||"pk"==l?QuerySet.get_pk(r):r[l],Array.isArray(r)){if(t.length-1==i+1&&"isnull"==t[i+1]){if(1==e)return s(r);if(0==e)return!s(r)}if(i==t.length-1&&null==e)return s(r);for(var c=t.slice(i+1),y=0;y<r.length;y++)return u(r[y],c,e)}else{if(t.length-1==i+1&&"isnull"==t[i+1]){if(1==e)return s(r);if(0==e)return!s(r)}if(i==t.length-1&&r==e)return!0}}return!1}for(var l in t){if(u(r,l.split(i),t[l])){if(!e)return!1}else if(e)return!1}return!0}filter(){if(1==arguments.length&&arguments[0]instanceof Function)return(e=super.filter(arguments[0])).setConfig(this.getConfig()),e;for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);if(!r.length)return(e=new QuerySet(this)).setConfig(this.getConfig()),e;Array.isArray(r)||(r=[r]);var e,i=this.separator,n=this.date_formats,s=this.getFilter;return(e=this.filter(function(t){for(var e=0;e<r.length;e++)if(s(t,r[e],!0,i,n))return!0;return!1})).setConfig(this.getConfig()),e}exclude(){for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);if(!r.length)return(e=new QuerySet(this)).setConfig(this.getConfig()),e;Array.isArray(r)||(r=[r]);var e,i=this.separator,n=this.date_formats,s=this.getFilter;return(e=new QuerySet(this.filter(function(t){for(var e=0;e<r.length;e++)if(s(t,r[e],!1,i,n))return!0;return!1}))).setConfig(this.getConfig()),e}remove(r){if(!r)return null;if(Number.isInteger(r)||r.constructor===String){for(var t=0;t<this.length;t++)if(QuerySet.get_pk(this[t])==parseInt(r))return this.splice(t,1),null}else{var e=this.filter(r);for(t=0;t<e.length;t++)this.pop(QuerySet.get_pk(to_delete[t]))}return null}values_list(r){if(!this.length)return[];var t=this.separator,e=r.split(t),i=[];function n(r,t,e){for(var i=0;i<t.length&&(r.hasOwnProperty(t[i])||("id"==t[i]||"pk"==t[i])&&QuerySet.get_pk(r));i++)if(r="id"!=t[i]&&"pk"!=t[i]||!QuerySet.get_pk(r)?r[t[i]]:QuerySet.get_pk(r),Array.isArray(r))if(i==t.length-1)for(var s=0;s<r.length;s++)e.push(r[s]);else{var u=t.slice(i+1);for(s=0;s<r.length;s++)n(r[s],u,e)}else e.push(r)}for(var s=0;s<this.length;s++)n(this[s],e,i);var u=new QuerySet(i);return u.setConfig(this.getConfig()),u}sum(r){return this.length?this.values_list(r).reduce((r,t)=>r+t):0}avg(r){return this.length?this.sum(field)/this.length:0}min(r){if(!this.length)return null;var t=this.date_formats;return this.values_list(r).reduce(function(r,e){var i=QuerySet.parseDate(r,t),n=QuerySet.parseDate(e,t);return i&&n?i<n?r:e:r<e?r:e})}max(r){if(!this.length)return null;var t=this.date_formats;return this.values_list(r).reduce(function(r,e){var i=QuerySet.parseDate(r,t),n=QuerySet.parseDate(e,t);return i&&n?i>n?r:e:r>e?r:e})}order_by(){for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);var e=this.separator,i=this.date_formats;function n(r,t){for(var e=0;e<t.length&&(r.hasOwnProperty(t[e])||("id"==t[e]||"pk"==t[e])&&QuerySet.get_pk(r));e++)if("id"!=t[e]&&"pk"!=t[e]||!QuerySet.get_pk(r)){if(Array.isArray(r[t[e]]))return r;r=r[t[e]]}else r=QuerySet.get_pk(r);return r}for(t=0;t<r.length;t++){var s=r[t],u="-"==s[0];this.sort(function(r,t){if(u){var l=n(t,h=s.substr(1).split(e)),a=n(r,h);if("boolean"==typeof l&&"boolean"==typeof a)return l===a?0:l?-1:1;var f=QuerySet.parseDate(l,i),o=QuerySet.parseDate(a,i);return f&&o?f===o?0:f>o?1:-1:l===a?0:l>a?1:-1}var h;l=n(t,h=s.split(e)),a=n(r,h);if("boolean"==typeof l&&"boolean"==typeof a)return l===a?0:a?-1:1;f=QuerySet.parseDate(l,i),o=QuerySet.parseDate(a,i);return f&&o?f===o?0:f<o?1:-1:l===a?0:l<a?1:-1})}return this}add(r){this.push(r)}append(r){this.push(r)}extend(r){for(var t=0;t<r.length;t++)this.push(r[t])}delete(){for(;this.length;)this.pop()}first(){return this.length>0?this[0]:null}last(){return this.length>0?this[this.length-1]:null}exists(){return this.length>1}count(){return this.length}static parseDate(r,t){if(!window.moment)return r;if(r.constructor==Date)return r;if(r.constructor==String)for(var e=0;e<t.length;e++){var i=moment(r,t[e]);if(i.isValid()&&i.format(t[e])==r)return i.toDate()}return null}static get_pk(r){return r?r.id?parseInt(r.id):r.pk?parseInt(r.pk):null:null}toArray(){return Array.from(this)}}
