/**
 * --------------------------------------------------------------------------
 * QuerySet (v1.1.0): queryset.js
 * Licensed under MIT (https://github.com/Worldrider/queryset/blob/master/LICENSE.txt)
 * --------------------------------------------------------------------------
 */
"use strict";class QuerySet extends Array{constructor(){super();let t=[];1==arguments.length&&Array.isArray(arguments[0])?t=Array.from(arguments[0]):arguments.length&&arguments[0]&&(t=Array.from(arguments));for(let e=0;e<t.length;e++)this.push(t[e])}get separator(){return"__"}get date_formats(){return["DD/MM/YYYY","DD-MM-YYYY","DD.MM.YYYY","DD/MM/YYYY HH:mm","DD-MM-YYYY HH:mm","DD.MM.YYYY HH:mm","YYYY-MM-DDThh:mm:ss","YYYY/MM/DD","YYYY-MM-DD","YYYY.MM.DD","YYYY/MM/DD HH:mm","YYYY-MM-DD HH:mm","YYYY.MM.DD HH:mm"]}static setConfig(t){t&&(t.separator&&Object.defineProperty(QuerySet.prototype,"separator",{get:function(){return t.separator}}),window.moment&&t.date_formats&&Object.defineProperty(QuerySet.prototype,"date_formats",{get:function(){return t.date_formats}}))}get(t){if(!t)return null;if(!Number.isInteger(t)&&t.constructor!==String)return this.filter(t).first();for(let e=0;e<this.length;e++)if(QuerySet.get_pk(this[e])==t.toString())return this[e];return null}update(t){if(QuerySet.get_pk(t)){let e=this.get(QuerySet.get_pk(t));if(!e)return this;let r=this.indexOf(e);for(let e in t)t.hasOwnProperty(e)&&(this[r][e]=t[e]);return this}for(let e=0;e<this.length;e++)for(let r in t)t.hasOwnProperty(r)&&(this[e][r]=t[r]);return this}getFilter(t,e,r,n,i){function l(t){if(null==t)return!0;if(Array.isArray(t)&&0==t.length)return!0;if(t.constructor===Object){for(let e in t)if(t.hasOwnProperty(e))return!1;return JSON.stringify(t)===JSON.stringify({})}return!1}function s(t,e,r){for(let n=0;n<e.length;n++){let u=e[n];if(!(t&&t.hasOwnProperty(u)||("id"==u||"pk"==u)&&QuerySet.get_pk(t))){if("isnull"==e[e.length-1]){if(1==r)return!0;if(0==r)return!1}if(n==e.length-1){if("not"==u){if(null==r)return!l(t);if(t!=r)return!0}else if("isnull"==u){if(1==r)return l(t);if(0==r)return!l(t)}else if("startswith"==u){if(null!=t&&t.constructor===String&&null!=r&&r.constructor===String&&t.trim().startsWith(r.trim()))return!0}else if("istartswith"==u){if(null!=t&&t.constructor===String&&null!=r&&r.constructor===String&&t.trim().toLowerCase().startsWith(r.trim().toLowerCase()))return!0}else if("endswith"==u){if(null!=t&&t.constructor===String&&null!=r&&r.constructor===String&&t.trim().endsWith(r.trim()))return!0}else if("iendswith"==u){if(null!=t&&t.constructor===String&&null!=r&&r.constructor===String&&t.trim().toLowerCase().endsWith(r.trim().toLowerCase()))return!0}else if("contains"==u){if(null!=t&&t.constructor===String&&null!=r&&r.constructor===String&&-1!==t.trim().indexOf(r.trim()))return!0}else if("icontains"==u){if(null!=t&&t.constructor===String&&null!=r&&r.constructor===String&&-1!==t.trim().toLowerCase().indexOf(r.trim().toLowerCase()))return!0}else if("exact"==u){if(null!=t&&t.constructor===String&&null!=r&&r.constructor===String&&t.trim()==r.trim())return!0}else if("iexact"==u){if(null!=t&&t.constructor===String&&null!=r&&r.constructor===String&&t.trim().toLowerCase()==r.trim().toLowerCase())return!0}else if("in"==u){if(null!=r&&Array.isArray(r))for(let e=0;e<r.length;e++)if(t==r[e])return!0}else if("range"==u){if(null!=r&&Array.isArray(r)){let e=r[0],n=r[r.length-1],l=QuerySet.parseDate(t,i),s=QuerySet.parseDate(e,i),u=QuerySet.parseDate(n,i);if(s&&u){if(l>=s&&l<=u)return!0}else if(t>=e&&t<=n)return!0}}else if("lt"==u){if(null!=r){let e=QuerySet.parseDate(t,i),n=QuerySet.parseDate(r,i);if(e&&n){if(e<n)return!0}else if(t<r)return!0}}else if("lte"==u){if(null!=r){let e=QuerySet.parseDate(t,i),n=QuerySet.parseDate(r,i);if(e&&n){if(e<=n)return!0}else if(t<=r)return!0}}else if("gt"==u){if(null!=r){let e=QuerySet.parseDate(t,i),n=QuerySet.parseDate(r,i);if(e&&n){if(e>n)return!0}else if(t>r)return!0}}else if("gte"==u){if(null!=r){let e=QuerySet.parseDate(t,i),n=QuerySet.parseDate(r,i);if(e&&n){if(e>=n)return!0}else if(t>=r)return!0}}else if(null==r)return!0}else if("not"!=e[e.length-1]&&null==r)return!0;return!1}if(t="id"==u||"pk"==u?QuerySet.get_pk(t):t[u],Array.isArray(t)){if(e.length-1==n+1&&"isnull"==e[n+1]){if(1==r)return l(t);if(0==r)return!l(t)}if(n==e.length-1&&null==r)return l(t);let i=e.slice(n+1);for(let e=0;e<t.length;e++)return s(t[e],i,r)}else{if(e.length-1==n+1&&"isnull"==e[n+1]){if(1==r)return l(t);if(0==r)return!l(t)}if(n==e.length-1&&t==r)return!0}}return!1}for(let i in e){if(s(t,i.split(n),e[i])){if(!r)return!1}else if(r)return!1}return!0}filter(){if(1==arguments.length&&arguments[0]instanceof Function)return super.filter(arguments[0]);let t=[];for(let e=0;e<arguments.length;e++)t.push(arguments[e]);if(!t.length)return new QuerySet(this);Array.isArray(t)||(t=[t]);let e=this.separator,r=this.date_formats,n=this.getFilter;return this.filter(function(i){for(let l=0;l<t.length;l++)if(n(i,t[l],!0,e,r))return!0;return!1})}exclude(){let t=[];for(let e=0;e<arguments.length;e++)t.push(arguments[e]);if(!t.length)return new QuerySet(this);Array.isArray(t)||(t=[t]);let e=this.separator,r=this.date_formats,n=this.getFilter;return new QuerySet(this.filter(function(i){for(let l=0;l<t.length;l++)if(n(i,t[l],!1,e,r))return!0;return!1}))}remove(t){let e=this.indexOf(t);-1!==e&&this.splice(e,1)}delete(t){if(!t)return null;if(Number.isInteger(t)||t.constructor===String){for(let e=0;e<this.length;e++)if(QuerySet.get_pk(this[e])==t.toString())return this.splice(e,1),null}else{let e=this.filter(t);for(let t=0;t<e.length;t++){let r=this.indexOf(e[t]);-1!==r&&this.pop(r)}}return null}clear(){for(;this.length;)this.pop()}values_list(t){if(!this.length)return new QuerySet([]);let e=this.separator,r=t.split(e),n=[];function i(t,e,r){for(let n=0;n<e.length&&(t&&t.hasOwnProperty(e[n])||("id"==e[n]||"pk"==e[n])&&QuerySet.get_pk(t));n++)if(t="id"!=e[n]&&"pk"!=e[n]||!QuerySet.get_pk(t)?t[e[n]]:QuerySet.get_pk(t),Array.isArray(t))if(n==e.length-1)for(let e=0;e<t.length;e++)r.push(t[e]);else{let l=e.slice(n+1);for(let e=0;e<t.length;e++)i(t[e],l,r)}else r.push(t)}for(let t=0;t<this.length;t++)i(this[t],r,n);return new QuerySet(n)}sum(t){if(!this.length)return 0;let e=this;return t&&(e=this.values_list(t)),e.length?e.reduce((t,e)=>parseFloat(t)+parseFloat(e)):0}avg(t){return this.length?this.sum(t)/this.length:0}min(t){if(!this.length)return null;let e=this.date_formats,r=this.values_list(t);return r.length?r.reduce(function(t,r){let n=QuerySet.parseDate(t,e),i=QuerySet.parseDate(r,e);return n&&i?n<i?t:r:t<r?t:r}):null}max(t){if(!this.length)return null;let e=this.date_formats,r=this.values_list(t);return r.length?r.reduce(function(t,r){let n=QuerySet.parseDate(t,e),i=QuerySet.parseDate(r,e);return n&&i?n>i?t:r:t>r?t:r}):null}order_by(){let t=[];for(let e=0;e<arguments.length;e++)t.push(arguments[e]);let e=this.separator,r=this.date_formats;function n(t,e){for(let r=0;r<e.length&&(t&&t.hasOwnProperty(e[r])||("id"==e[r]||"pk"==e[r])&&QuerySet.get_pk(t));r++)if("id"!=e[r]&&"pk"!=e[r]||!QuerySet.get_pk(t)){if(Array.isArray(t[e[r]]))return t;t=t[e[r]]}else t=QuerySet.get_pk(t);return t}for(let i=0;i<t.length;i++){let l=t[i],s="-"==l[0];this.sort(function(t,i){if(s){let s=l.substr(1).split(e),u=n(i,s),f=n(t,s);if("boolean"==typeof u&&"boolean"==typeof f)return u===f?0:u?-1:1;let o=QuerySet.parseDate(u,r),h=QuerySet.parseDate(f,r);return o&&h?o===h?0:o>h?1:-1:u===f?0:u>f?1:-1}let u=l.split(e),f=n(i,u),o=n(t,u);if("boolean"==typeof f&&"boolean"==typeof o)return f===o?0:o?-1:1;let h=QuerySet.parseDate(f,r),a=QuerySet.parseDate(o,r);return h&&a?h===a?0:h<a?1:-1:f===o?0:f<o?1:-1})}return this}distinct(){let t=[];for(let e=0;e<arguments.length;e++)t.push(arguments[e]);if(!t.length){let t=new Set(this);return new QuerySet(Array.from(t))}let e=this.separator;function r(t,e){for(let r=0;r<e.length&&(t&&t.hasOwnProperty(e[r])||("id"==e[r]||"pk"==e[r])&&QuerySet.get_pk(t));r++)if("id"!=e[r]&&"pk"!=e[r]||!QuerySet.get_pk(t)){if(Array.isArray(t[e[r]]))return t;t=t[e[r]]}else t=QuerySet.get_pk(t);return t}let n=new QuerySet;for(const i of this){let l=!0;for(let s=0;s<t.length;s++){let u={},f=t[s].split(e);u[t[s]]=r(i,f),n.filter(u).exists()&&(l=!1)}l&&n.append(i)}let i=new Set(n);return new QuerySet(Array.from(i))}add(t){this.push(t)}append(t){this.push(t)}prepend(t){this.unshift(t)}extend(t){for(let e=0;e<t.length;e++)this.push(t[e])}pop(t){return null!=t?this.length>t&&this[t]?this.splice(t,1)[0]:void 0:this.length?this.splice(this.length-1,1)[0]:void 0}first(){return this.length>0?this[0]:null}last(){return this.length>0?this[this.length-1]:null}exists(){return 0!=this.length}count(){return this.length}static parseDate(t,e){if(!window.moment)return t;if(!t)return t;if(t.constructor==Date)return t;if(t.constructor==String)for(let r=0;r<e.length;r++){let n=moment(t,e[r]);if(n.isValid()&&n.format(e[r])==t)return n.toDate()}return null}static get_pk(t){return t?t.id?t.id.toString():t.pk?t.pk.toString():null:null}toArray(){return Array.from(this)}}
