/**
 * --------------------------------------------------------------------------
 * QuerySet (v1.0.4): queryset.js
 * Licensed under MIT (https://github.com/Worldrider/queryset/blob/master/LICENSE.txt)
 * --------------------------------------------------------------------------
 */
"use strict";class QuerySet extends Array{constructor(){super();let r=[];1==arguments.length&&Array.isArray(arguments[0])?r=Array.from(arguments[0]):arguments.length&&arguments[0]&&(r=Array.from(arguments));for(var t=0;t<r.length;t++)this.push(r[t])}get separator(){return"__"}get date_formats(){return["DD/MM/YYYY","DD-MM-YYYY","DD.MM.YYYY","DD/MM/YYYY HH:mm","DD-MM-YYYY HH:mm","DD.MM.YYYY HH:mm","YYYY-MM-DDThh:mm:ss","YYYY/MM/DD","YYYY-MM-DD","YYYY.MM.DD","YYYY/MM/DD HH:mm","YYYY-MM-DD HH:mm","YYYY.MM.DD HH:mm"]}static setConfig(r){r&&(r.separator&&Object.defineProperty(QuerySet.prototype,"separator",{get:function(){return r.separator}}),window.moment&&r.date_formats&&Object.defineProperty(QuerySet.prototype,"date_formats",{get:function(){return r.date_formats}}))}get(r){if(!r)return null;if(!Number.isInteger(r)&&r.constructor!==String)return this.filter(r).first();for(var t=0;t<this.length;t++)if(QuerySet.get_pk(this[t])==parseInt(r))return this[t];return null}update(r){if(QuerySet.get_pk(r)){let e=this.get(QuerySet.get_pk(r));if(!e)return this;let n=this.indexOf(e);for(var t in r)r.hasOwnProperty(t)&&(this[n][t]=r[t]);return this}for(var e=0;e<this.length;e++)for(var t in r)r.hasOwnProperty(t)&&(this[e][t]=r[t]);return this}getFilter(r,t,e,n,i){function s(r){if(null==r)return!0;if(Array.isArray(r)&&0==r.length)return!0;if(r.constructor===Object){for(var t in r)if(r.hasOwnProperty(t))return!1;return JSON.stringify(r)===JSON.stringify({})}return!1}function u(r,t,e){for(var n=0;n<t.length;n++){var l=t[n];if(!r.hasOwnProperty(l)&&("id"!=l&&"pk"!=l||!QuerySet.get_pk(r))){if("isnull"==t[t.length-1]){if(1==e)return!0;if(0==e)return!1}if(n==t.length-1){if("not"==l){if(null==e)return!s(r);if(r!=e)return!0}else if("isnull"==l){if(1==e)return s(r);if(0==e)return!s(r)}else if("startswith"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().startsWith(e.trim()))return!0}else if("istartswith"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().toLowerCase().startsWith(e.trim().toLowerCase()))return!0}else if("endswith"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().endsWith(e.trim()))return!0}else if("iendswith"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().toLowerCase().endsWith(e.trim().toLowerCase()))return!0}else if("contains"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&-1!==r.trim().indexOf(e.trim()))return!0}else if("icontains"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&-1!==r.trim().toLowerCase().indexOf(e.trim().toLowerCase()))return!0}else if("exact"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim()==e.trim())return!0}else if("iexact"==l){if(null!=r&&r.constructor===String&&null!=e&&e.constructor===String&&r.trim().toLowerCase()==e.trim().toLowerCase())return!0}else if("in"==l){if(null!=e&&Array.isArray(e))for(var a=0;a<e.length;a++)if(r==e[a])return!0}else if("range"==l){if(null!=e&&Array.isArray(e)){var f=e[0],o=e[e.length-1],h=QuerySet.parseDate(r,i),g=QuerySet.parseDate(f,i),p=QuerySet.parseDate(o,i);if(g&&p){if(h>=g&&h<=p)return!0}else if(r>=f&&r<=o)return!0}}else if("lt"==l){if(null!=e){g=QuerySet.parseDate(r,i),p=QuerySet.parseDate(e,i);if(g&&p){if(g<p)return!0}else if(r<e)return!0}}else if("lte"==l){if(null!=e){g=QuerySet.parseDate(r,i),p=QuerySet.parseDate(e,i);if(g&&p){if(g<=p)return!0}else if(r<=e)return!0}}else if("gt"==l){if(null!=e){g=QuerySet.parseDate(r,i),p=QuerySet.parseDate(e,i);if(g&&p){if(g>p)return!0}else if(r>e)return!0}}else if("gte"==l){if(null!=e){g=QuerySet.parseDate(r,i),p=QuerySet.parseDate(e,i);if(g&&p){if(g>=p)return!0}else if(r>=e)return!0}}else if(null==e)return!0}else if("not"!=t[t.length-1]&&null==e)return!0;return!1}if(r="id"==l||"pk"==l?QuerySet.get_pk(r):r[l],Array.isArray(r)){if(t.length-1==n+1&&"isnull"==t[n+1]){if(1==e)return s(r);if(0==e)return!s(r)}if(n==t.length-1&&null==e)return s(r);for(var y=t.slice(n+1),c=0;c<r.length;c++)return u(r[c],y,e)}else{if(t.length-1==n+1&&"isnull"==t[n+1]){if(1==e)return s(r);if(0==e)return!s(r)}if(n==t.length-1&&r==e)return!0}}return!1}for(var l in t){if(u(r,l.split(n),t[l])){if(!e)return!1}else if(e)return!1}return!0}filter(){if(1==arguments.length&&arguments[0]instanceof Function)return super.filter(arguments[0]);for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);if(!r.length)return new QuerySet(this);Array.isArray(r)||(r=[r]);var e=this.separator,n=this.date_formats,i=this.getFilter;return this.filter(function(t){for(var s=0;s<r.length;s++)if(i(t,r[s],!0,e,n))return!0;return!1})}exclude(){for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);if(!r.length)return new QuerySet(this);Array.isArray(r)||(r=[r]);var e=this.separator,n=this.date_formats,i=this.getFilter;return new QuerySet(this.filter(function(t){for(var s=0;s<r.length;s++)if(i(t,r[s],!1,e,n))return!0;return!1}))}remove(r){if(!r)return null;if(Number.isInteger(r)||r.constructor===String){for(var t=0;t<this.length;t++)if(QuerySet.get_pk(this[t])==parseInt(r))return this.splice(t,1),null}else{var e=this.filter(r);for(t=0;t<e.length;t++)this.pop(QuerySet.get_pk(to_delete[t]))}return null}values_list(r){if(!this.length)return new QuerySet([]);var t=this.separator,e=r.split(t),n=[];function i(r,t,e){for(var n=0;n<t.length&&(r.hasOwnProperty(t[n])||("id"==t[n]||"pk"==t[n])&&QuerySet.get_pk(r));n++)if(r="id"!=t[n]&&"pk"!=t[n]||!QuerySet.get_pk(r)?r[t[n]]:QuerySet.get_pk(r),Array.isArray(r))if(n==t.length-1)for(var s=0;s<r.length;s++)e.push(r[s]);else{var u=t.slice(n+1);for(s=0;s<r.length;s++)i(r[s],u,e)}else e.push(r)}for(var s=0;s<this.length;s++)i(this[s],e,n);return new QuerySet(n)}sum(r){if(!this.length)return 0;var t=this;return r&&(t=this.values_list(r)),t.length?t.reduce((r,t)=>parseFloat(r)+parseFloat(t)):0}avg(r){return this.length?this.sum(r)/this.length:0}min(r){if(!this.length)return null;var t=this.date_formats,e=this.values_list(r);return e.length?e.reduce(function(r,e){var n=QuerySet.parseDate(r,t),i=QuerySet.parseDate(e,t);return n&&i?n<i?r:e:r<e?r:e}):null}max(r){if(!this.length)return null;var t=this.date_formats,e=this.values_list(r);return e.length?e.reduce(function(r,e){var n=QuerySet.parseDate(r,t),i=QuerySet.parseDate(e,t);return n&&i?n>i?r:e:r>e?r:e}):null}order_by(){for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);var e=this.separator,n=this.date_formats;function i(r,t){for(var e=0;e<t.length&&(r.hasOwnProperty(t[e])||("id"==t[e]||"pk"==t[e])&&QuerySet.get_pk(r));e++)if("id"!=t[e]&&"pk"!=t[e]||!QuerySet.get_pk(r)){if(Array.isArray(r[t[e]]))return r;r=r[t[e]]}else r=QuerySet.get_pk(r);return r}for(t=0;t<r.length;t++){var s=r[t],u="-"==s[0];this.sort(function(r,t){if(u){var l=i(t,h=s.substr(1).split(e)),a=i(r,h);if("boolean"==typeof l&&"boolean"==typeof a)return l===a?0:l?-1:1;var f=QuerySet.parseDate(l,n),o=QuerySet.parseDate(a,n);return f&&o?f===o?0:f>o?1:-1:l===a?0:l>a?1:-1}var h;l=i(t,h=s.split(e)),a=i(r,h);if("boolean"==typeof l&&"boolean"==typeof a)return l===a?0:a?-1:1;f=QuerySet.parseDate(l,n),o=QuerySet.parseDate(a,n);return f&&o?f===o?0:f<o?1:-1:l===a?0:l<a?1:-1})}return this}distinct(){for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);if(!r.length){var e=new Set(this);return new QuerySet(Array.from(e))}var n=this.separator;function i(r,t){for(var e=0;e<t.length&&(r.hasOwnProperty(t[e])||("id"==t[e]||"pk"==t[e])&&QuerySet.get_pk(r));e++)if("id"!=t[e]&&"pk"!=t[e]||!QuerySet.get_pk(r)){if(Array.isArray(r[t[e]]))return r;r=r[t[e]]}else r=QuerySet.get_pk(r);return r}let s=new QuerySet;for(const e of this){var u=!0;for(t=0;t<r.length;t++){var l={},a=r[t].split(n);l[r[t]]=i(e,a),s.filter(l).exists()&&(u=!1)}u&&s.append(e)}e=new Set(s);return new QuerySet(Array.from(e))}add(r){this.push(r)}append(r){this.push(r)}extend(r){for(var t=0;t<r.length;t++)this.push(r[t])}delete(){for(;this.length;)this.pop()}first(){return this.length>0?this[0]:null}last(){return this.length>0?this[this.length-1]:null}exists(){return 0!=this.length}count(){return this.length}static parseDate(r,t){if(!window.moment)return r;if(r.constructor==Date)return r;if(r.constructor==String)for(var e=0;e<t.length;e++){var n=moment(r,t[e]);if(n.isValid()&&n.format(t[e])==r)return n.toDate()}return null}static get_pk(r){return r?r.id?parseInt(r.id):r.pk?parseInt(r.pk):null:null}toArray(){return Array.from(this)}}
